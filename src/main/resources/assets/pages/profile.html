<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Profile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <script src="../js/main.js"></script>
    <script src="../js/jquery.js"></script>
</head>

<header>
    <ul class="w3-navbar w3-border w3-indigo w3-padding-4">
        <li><a class="w3-hover-indigo w3-text-white w3-hover-text-light-blue" href="/">BookTrader</a></li>
    </ul>
</header>
<br>

<body class="w3-white">

<div class="w3-container" id="main">
    <header class="w3-container w3-padding-32 w3-center w3-light-grey" id="username">
        <h1 class="w3-jumbo"><span id="user_name">I'm</span></h1>
    </header>

    <div class="w3-content">
        <h2>About Me</h2>
        <a id="about-me-edit" href="#" onclick="$('#modal-about-me-edit').show();"><i class="fa fa-pencil-square"></i></a>
        <p id="about_me"> Some text about me. </p>
        <br>
        <h3 class="w3-padding-16 w3-text-black">My Rating</h3>
        <p  id = "show_rating"></p>
        <p>
            <script>
                
                function displayRating() {
                    var userId = sessionStorage.getItem('id');
                    $.get("/api/profile/get_user_rating/" + userId, function (response) {
                        var rating = JSON.parse(response);
                        document.write(rating);
                    })
                }
              document.getElementById("show_rating").innerHTML = displayRating();
            </script>
        </p>
        <h2>My Rating</h2>
        <p class="w3-wide">Reputation</p>
        <br>
        <h2>My Posts</h2>
        <a href="#" class="w3-btn w3-white w3-border w3-border-green w3-round w3-padding-large">CLICK ME TO SEE THE
            POSTS</a>
        <br>
    </div>

    <!-- Portfolio Section -->
    <div class="w3-padding-64 w3-content" id="posts">
        <h2 class="w3-text-black">My Posts</h2>
        <hr style="width:200px" class="w3-opacity">

        <!-- Grid for posts -->
        <div class="w3-row-padding" style="margin:0 -16px">
            <div class="w3-half">

            </div>
            <!-- End posts grid -->
        </div>
        <!-- End Portfolio Section -->
    </div>
    <!-- Rate Me Section-->
    <div class="w3-padding-64 w3-content w3-text-grey" id="rate_me">
        <h2 class="w3-text-black">Rate Me</h2>
        <hr style="width:200px" class="w3-opacity">
        <p>Select a rating: </p>
        <form action="" onsubmit="return confirm('Are you sure you want to rate this user?'); ">
            <select name="Rating" id="rate_val">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
            <br><br>
            <input class="w3-button w3-btn w3-green w3-padding-large w3-margin-right w3-margin-top w3-round"
                   type="submit" onsubmit="return confirm('Are you sure you want to rate this user?');">
            <script>
                //In progress:
               // function submitRating(){
                //var val = document.getElementById("rate_val");
                //var ratingChosen = val.options[val.selectedIndex].value;
                //}
            </script>
        </form>
    </div>
    <!-- Contact Section -->
    <div class="w3-padding-64 w3-content w3-text-grey" id="contact">
        <h2 class="w3-text-black">Contact Me</h2>
        <hr style="width:200px" class="w3-opacity">

    <div class="w3-content">
        <br>
        <br>
        <h2>Contact Me</h2>
        <div class="w3-section">
            <p>
                <i class="fa fa-phone fa-fw w3-text-black w3-xlarge w3-margin-right"></i>
                <a id="phone-edit" href="#" onclick="$('#modal-phone-edit').show();"><i class="fa fa-pencil-square"></i></a>
                <span id="phone_number"></span>
            </p>
        </div>
    </div>

    <div id="modal-about-me-edit" class="w3-modal">
        <div class="w3-modal-content w3-card-8 w3-animate-top">
            <header class="w3-container w3-indigo">
        <span onclick="document.getElementById('modal-about-me-edit').style.display='none'"
              class="w3-closebtn">&times;</span>
                <h2>Edit About Me</h2>
            </header>
            <div class="w3-container">
                <p>
                    <input name="about_me" title="about_me" class="w3-input w3-border w3-round-large w3-margin-top" type="text">
                </p>
            </div>
            <footer class="w3-container w3-indigo">
                <span class="w3-right w3-padding-8">
                    <button id="cancel-aboutme" class="w3-btn w3-red" onclick="document.getElementById('modal-about-me-edit').style.display='none'">CANCEL</button>
                    <button id="save-aboutme" class="w3-btn w3-green" onclick="saveEditAboutMe()">SAVE</button>
                </span>
            </footer>
        </div>
    </div>

    <div id="modal-phone-edit" class="w3-modal">
        <div class="w3-modal-content w3-card-8 w3-animate-top">
            <header class="w3-container w3-indigo">
        <span onclick="document.getElementById('modal-phone-edit').style.display='none'"
              class="w3-closebtn">&times;</span>
                <h2>Change Phone Number</h2>
            </header>
            <div class="w3-container">
                <p>
                    <input name="phone" title="phone" class="w3-input w3-border w3-round-large w3-margin-top" type="text">
                </p>
            </div>
            <footer class="w3-container w3-indigo">
                <span class="w3-right w3-padding-8">
                    <button id="cancel-phone" class="w3-btn w3-red" onclick="document.getElementById('modal-phone-edit').style.display='none'">CANCEL</button>
                    <button id="save-phone" class="w3-btn w3-green" onclick="saveEditPhone()">SAVE</button>
                </span>
            </footer>
        </div>
    </div>

    <script>
        var myId = sessionStorage.getItem("id");
        var userId = getParameterByName("user_id");
        if (myId !== userId) {
            $('#phone-edit').hide();
            $('#about-me-edit').hide();
            $('#email-edit').hide();
        }
        $.get("/api/profile/get_seller_profile_by_user_id/" + userId, function(data) {
            data = JSON.parse(data);
            var profile = {};
            profile.about_me = data.about_me;
            profile.phone_number = data.phone_number;
            $('#about_me').html(profile.about_me);
            $('#phone_number').html(profile.phone_number);
        });

        $.get("/api/user/get_user/" + userId, function(data) {
            data = JSON.parse(data);
            $('#user_name').html("I'm " + data.name);
        });

        function saveEditAboutMe() {
            var about_me = $('input[title="about_me"]').val();
            if (about_me && about_me !== $('#about_me').html()) {
                $.get('/api/profile/update_about_me_by_user_id/' + userId + '/' + about_me, function (data) {
                    alert(data);
                });
            }
            window.location.reload();
        }

        function saveEditPhone() {
            var phone_number = $('input[title="phone"]').val();
            if (phone_number && phone_number !== $('#phone_number').html()) {
                $.get('/api/profile/update_phone_number_by_user_id/' + userId + '/' + phone_number, function (data) {
                    alert(data);
                });
            }
            window.location.reload();
        }
    </script>
</div>

</body>
</html>
